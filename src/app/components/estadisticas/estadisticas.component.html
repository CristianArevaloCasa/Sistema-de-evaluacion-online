<div class="estadisticas-container">
  <div class="header">
    <div class="header-content animate-slide-down">
      <div class="header-title">
        <svg class="stats-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="20" x2="18" y2="10"></line>
          <line x1="12" y1="20" x2="12" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
        <h1>Estad√≠sticas de Evaluaci√≥n</h1>
      </div>
      <button class="btn btn-secondary" (click)="volver()">‚Üê Volver a Evaluaciones</button>
    </div>
  </div>

  <div class="content">
    <!-- Loading -->
    <div *ngIf="loading" class="loading">
      <p>Cargando estad√≠sticas...</p>
    </div>

    <!-- Contenido -->
    <div *ngIf="!loading && evaluacion">
      <!-- Informaci√≥n de la evaluaci√≥n -->
      <div class="info-card">
        <h2>{{ evaluacion.titulo }}</h2>
        <p class="descripcion">{{ evaluacion.descripcion }}</p>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Categor√≠a:</span>
            <span class="info-value">{{ evaluacion.categoria }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Estado:</span>
            <span class="info-value badge" [ngClass]="'estado-' + evaluacion.estado">{{ evaluacion.estado }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Fecha l√≠mite:</span>
            <span class="info-value">{{ formatearFecha(evaluacion.fechaLimite) }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Puntaje m√°ximo:</span>
            <span class="info-value">{{ evaluacion.puntajeMaximo }} puntos</span>
          </div>
          <div class="info-item">
            <span class="info-label">Total preguntas:</span>
            <span class="info-value">{{ evaluacion.preguntas?.length || 0 }}</span>
          </div>
        </div>
      </div>

      <!-- Sin respuestas -->
      <div *ngIf="!estadisticas" class="empty-state">
        <div class="empty-icon">üìä</div>
        <h2>No hay respuestas registradas</h2>
        <p>A√∫n no hay estudiantes que hayan completado esta evaluaci√≥n.</p>
      </div>

      <!-- Estad√≠sticas -->
      <div *ngIf="estadisticas" class="estadisticas-grid">
        <!-- Resumen General -->
        <div class="stats-card">
          <h3>üìà Resumen General</h3>
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">Total de respuestas:</span>
              <span class="stat-value highlight">{{ estadisticas.totalRespuestas }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Promedio general:</span>
              <span class="stat-value highlight">{{ redondear(estadisticas.promedioGeneral) }} / {{ evaluacion.puntajeMaximo }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Puntaje m√°s alto:</span>
              <span class="stat-value success">{{ redondear(estadisticas.puntajeMaximo) }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Puntaje m√°s bajo:</span>
              <span class="stat-value danger">{{ redondear(estadisticas.puntajeMinimo) }}</span>
            </div>
          </div>
        </div>

        <!-- Aprobaci√≥n -->
        <div class="stats-card">
          <h3>‚úì Aprobaci√≥n</h3>
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">Aprobados:</span>
              <span class="stat-value success">{{ estadisticas.aprobados }} ({{ redondear(estadisticas.porcentajeAprobacion) }}%)</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Reprobados:</span>
              <span class="stat-value danger">{{ estadisticas.reprobados }} ({{ redondear(100 - estadisticas.porcentajeAprobacion) }}%)</span>
            </div>
          </div>
          
          <div class="progress-bar">
            <div class="progress-fill success" [style.width]="estadisticas.porcentajeAprobacion + '%'"></div>
            <div class="progress-fill danger" [style.width]="(100 - estadisticas.porcentajeAprobacion) + '%'"></div>
          </div>
        </div>

        <!-- Distribuci√≥n de Puntajes -->
        <div class="stats-card full-width">
          <h3>üìä Distribuci√≥n de Puntajes</h3>
          <div class="distribution-chart">
            <div *ngFor="let dist of estadisticas.distribucionPuntajes" class="distribution-item">
              <div class="distribution-header">
                <span class="range-label">{{ dist.rango }} pts</span>
                <span class="range-count">{{ dist.cantidad }} estudiantes</span>
              </div>
              <div class="distribution-bar">
                <div class="bar-fill" [style.width]="getBarWidth(dist.cantidad)"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Lista de Respuestas -->
        <div class="stats-card full-width">
          <h3>üìù Respuestas Individuales</h3>
          <div class="respuestas-table">
            <table>
              <thead>
                <tr>
                  <th>Estudiante</th>
                  <th>Fecha de Entrega</th>
                  <th>Puntaje</th>
                  <th>Estado</th>
                  <th>Porcentaje</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let respuesta of respuestas">
                  <td>{{ respuesta.userName }}</td>
                  <td>{{ formatearFecha(respuesta.fechaEntrega) }}</td>
                  <td><strong>{{ redondear(respuesta.puntajeObtenido) }}</strong> / {{ evaluacion.puntajeMaximo }}</td>
                  <td>
                    <span class="badge" [ngClass]="respuesta.estado === 'completada' ? 'estado-activa' : 'estado-borrador'">
                      {{ respuesta.estado }}
                    </span>
                  </td>
                  <td>
                    <span [ngClass]="respuesta.puntajeObtenido >= (evaluacion.puntajeMaximo * 0.6) ? 'success' : 'danger'">
                      {{ redondear((respuesta.puntajeObtenido / evaluacion.puntajeMaximo) * 100) }}%
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
